<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2113.65">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; color: #000000; -webkit-text-stroke: #000000}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px 'Hiragino Sans'; color: #000000; -webkit-text-stroke: #000000}
    p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; color: #000000; -webkit-text-stroke: #000000; min-height: 14.0px}
    span.s1 {font-kerning: none}
    span.s2 {font: 12.0px 'Hiragino Sans'; font-kerning: none}
    span.s3 {font: 12.0px Helvetica; font-kerning: none}
  </style>
</head>
<body>
<p class="p1"><span class="s1">&lt;!DOCTYPE html&gt;</span></p>
<p class="p1"><span class="s1">&lt;html lang="ja"&gt;</span></p>
<p class="p1"><span class="s1">&lt;head&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;meta charset="UTF-8"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;title&gt;</span><span class="s2">じゃがバター順番待ち</span><span class="s1">&lt;/title&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;style&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>body { font-family: 'Helvetica Neue', 'Arial', sans-serif; margin: 0; padding: 20px; background-color: #f4f4f9; color: #333; line-height: 1.6; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.container { max-width: 600px; margin: auto; background: #fff; padding: 30px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>h1 { color: #4a4a4a; text-align: center; margin-bottom: 20px; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>label { display: block; margin-bottom: 8px; font-weight: bold; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>select { width: 100%; padding: 10px; margin-bottom: 20px; border: 1px solid #ccc; border-radius: 5px; font-size: 16px; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>button { width: 100%; padding: 12px; border: none; border-radius: 5px; background-color: #5cb85c; color: white; font-size: 18px; cursor: pointer; transition: background-color 0.3s ease; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>button:hover { background-color: #4cae4c; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.reservation-info { margin-top: 20px; border-top: 2px solid #eee; padding-top: 20px; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.reservation-info h2 { text-align: center; color: #555; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.info-item { font-size: 18px; margin-bottom: 10px; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.cancel-btn { background-color: #d9534f; margin-top: 10px; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.cancel-btn:hover { background-color: #c9302c; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;/style&gt;</span></p>
<p class="p1"><span class="s1">&lt;/head&gt;</span></p>
<p class="p1"><span class="s1">&lt;body&gt;</span></p>
<p class="p1"><span class="s1"><br>
</span></p>
<p class="p1"><span class="s1">&lt;div class="container"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;h1&gt;3</span><span class="s2">年</span><span class="s1">3</span><span class="s2">組</span><span class="s1"> </span><span class="s2">じゃがバター販売</span><span class="s1">&lt;/h1&gt;</span></p>
<p class="p2"><span class="s3"><span class="Apple-converted-space">    </span>&lt;p&gt;</span><span class="s1">人数を選んで予約してください（最大</span><span class="s3">3</span><span class="s1">名まで）</span><span class="s3">&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><br>
</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;div id="reservation-form"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;label for="people"&gt;</span><span class="s2">予約人数：</span><span class="s1">&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;select id="people"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;option value="1"&gt;1</span><span class="s2">人</span><span class="s1">&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;option value="2"&gt;2</span><span class="s2">人</span><span class="s1">&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;option value="3"&gt;3</span><span class="s2">人</span><span class="s1">&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/select&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;button id="reserve-btn"&gt;</span><span class="s2">予約する</span><span class="s1">&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><br>
</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;div id="reservation-info" class="reservation-info" style="display:none;"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;h2&gt;</span><span class="s2">あなたの予約情報</span><span class="s1">&lt;/h2&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div class="info-item"&gt;</span><span class="s2">受付番号</span><span class="s1">: &lt;span id="my-reservation-number"&gt;&lt;/span&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div class="info-item"&gt;</span><span class="s2">現在の待ち人数</span><span class="s1">: &lt;span id="my-waiting-count"&gt;&lt;/span&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div class="info-item"&gt;</span><span class="s2">おおよその待ち時間</span><span class="s1">: &lt;span id="my-waiting-time"&gt;&lt;/span&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;button class="cancel-btn" id="cancel-my-reservation-btn"&gt;</span><span class="s2">予約をキャンセルする</span><span class="s1">&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><br>
</span></p>
<p class="p1"><span class="s1">&lt;script&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwb3sWBBY5z2cE_d5Y0_zAbpShSR1vfkJACcX_MerYb1fg0Ofr6XZa7Vu9RuK-TmJKX1Q/exec';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const PRODUCTION_RATE_PER_15_MINS = 19;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const TOTAL_PRODUCTION_RATE_PER_MIN = PRODUCTION_RATE_PER_15_MINS / 15;</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>let myReservationNumber = null;</span></p>
<p class="p1"><span class="s1"><br>
</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>window.onload = function() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const storedNumber = localStorage.getItem('myReservationNumber');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (storedNumber) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>myReservationNumber = parseInt(storedNumber);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>document.getElementById('reservation-form').style.display = 'none';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>document.getElementById('reservation-info').style.display = 'block';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>updateDisplay();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>setInterval(updateDisplay, 10000);<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>};</span></p>
<p class="p1"><span class="s1"><br>
</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>document.getElementById('reserve-btn').addEventListener('click', function() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const people = document.getElementById('people').value;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const formData = new FormData();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>formData.append('action', 'reserve');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>formData.append('people', people);</span></p>
<p class="p1"><span class="s1"><br>
</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>fetch(SCRIPT_URL, {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>method: 'POST',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>body: formData,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}).then(() =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>alert('</span><span class="s2">予約が完了しました！</span><span class="s1">'); // </span><span class="s2">予約完了メッセージを追加</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>setTimeout(() =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>updateDisplay(true);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}, 3000);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}).catch(error =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>console.error('</span><span class="s2">予約エラー</span><span class="s1">:', error);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>alert('</span><span class="s2">予約に失敗しました。もう一度お試しください。</span><span class="s1">');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p1"><span class="s1"><br>
</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>async function updateDisplay(isNewReservation = false) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>try {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const reservationResponse = await fetch(SCRIPT_URL, {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>method: 'POST',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>body: new URLSearchParams({ action: 'getReservations' }),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>headers: {'Content-Type': 'application/x-www-form-urlencoded'},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const reservationData = await reservationResponse.json();</span></p>
<p class="p1"><span class="s1"><br>
</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (reservationData.success) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const reservations = reservationData.reservations;</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const baseWaitTimeAdjustment = parseInt(localStorage.getItem('baseWaitTimeAdjustment')) || 0;</span></p>
<p class="p3"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>if (isNewReservation) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>const lastReservation = reservations[reservations.length - 1];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>if (lastReservation) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>myReservationNumber = lastReservation.reservationNumber;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>localStorage.setItem('myReservationNumber', myReservationNumber);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>document.getElementById('reservation-form').style.display = 'none';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>document.getElementById('reservation-info').style.display = 'block';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p1"><span class="s1"><br>
</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>if (myReservationNumber) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>const myIndex = reservations.findIndex(r =&gt; r.reservationNumber === myReservationNumber);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>if (myIndex !== -1) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>const waitingCount = myIndex;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>const totalPeopleAhead = reservations.slice(0, myIndex).reduce((sum, res) =&gt; sum + res.people, 0);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>const waitTime = Math.ceil(totalPeopleAhead / TOTAL_PRODUCTION_RATE_PER_MIN) + baseWaitTimeAdjustment;</span></p>
<p class="p1"><span class="s1"><br>
</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>document.getElementById('my-reservation-number').textContent = myReservationNumber;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>document.getElementById('my-waiting-count').textContent = waitingCount;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>document.getElementById('my-waiting-time').textContent = `${waitTime}</span><span class="s2">分</span><span class="s1">`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>alert('</span><span class="s2">予約が完了しました。</span><span class="s1">');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>clearMyReservation();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>} catch (error) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>console.error('</span><span class="s2">表示更新エラー</span><span class="s1">:', error);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><br>
</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>document.getElementById('cancel-my-reservation-btn').addEventListener('click', function() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (!confirm('</span><span class="s2">本当に予約をキャンセルしますか？</span><span class="s1">')) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><br>
</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const formData = new FormData();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>formData.append('action', 'cancelReservation');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>formData.append('reservationNumber', myReservationNumber);</span></p>
<p class="p1"><span class="s1"><br>
</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>fetch(SCRIPT_URL, {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>method: 'POST',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>body: formData,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}).then(() =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>alert('</span><span class="s2">予約をキャンセルしました。</span><span class="s1">');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>clearMyReservation();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}).catch(error =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>console.error('</span><span class="s2">キャンセルエラー</span><span class="s1">:', error);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p1"><span class="s1"><br>
</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function clearMyReservation() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>localStorage.removeItem('myReservationNumber');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>myReservationNumber = null;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>document.getElementById('reservation-form').style.display = 'block';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>document.getElementById('reservation-info').style.display = 'none';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>location.reload();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1">&lt;/script&gt;</span></p>
<p class="p1"><span class="s1"><br>
</span></p>
<p class="p1"><span class="s1">&lt;/body&gt;</span></p>
<p class="p1"><span class="s1">&lt;/html&gt;</span></p>
</body>
</html>
